{% extends 'base.html' %}
{% block head_extra %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block body %}
{% include 'admin_navbar.html' %}
<div class="container">
    <h2 class="mb-4">Histórico de Comprovantes</h2>

    <div class="row mb-3">
        <div class="col-md-6">
            <input type="text" id="filtro-nome" class="form-control" placeholder="Filtrar por nome...">
        </div>
        <div class="col-md-4">
            <select id="filtro-status" class="form-select">
                <option value="">Todos os Status</option>
                <option value="Aprovado">Aprovado</option>
                <option value="Rejeitado">Rejeitado</option>
                <option value="Aguardando confirmação">Aguardando confirmação</option>
                <option value="Pendente">Pendente</option>
            </select>
        </div>
    </div>

    {% if comprovantes %}
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Nome</th>
                    <th>Email</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>Arquivo</th>
                </tr>
            </thead>
            <tbody>
                {% for comp in comprovantes %}
                <tr>
                    <td>{{ comp.usuario.nome }}</td>
                    <td>{{ comp.usuario.email }}</td>
                    <td>{{ comp.data_envio.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>
                        {% if comp.status == 'Aprovado' %}
                        <span class="badge bg-success">Aprovado</span>
                        {% elif comp.status == 'Rejeitado' %}
                        <span class="badge bg-danger">Rejeitado</span>
                        {% elif comp.status == 'AGUARDANDO CONFIRMAÇÃO' %}
                        <span class="badge bg-warning text-dark">Aguardando confirmação</span>
                        {% else %}
                        <span class="badge bg-secondary">Pendente</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if comp.link_arquivo %}
                        <a class="btn btn-primary btn-sm" href="{{ comp.link_arquivo }}" target="_blank">Ver</a>
                        {% else %}
                        <span class="text-muted">—</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center">Nenhum histórico disponível.</div>
    {% endif %}
</div>

<script>
    // Filtro JS (igual seu painel antigo)
    document.addEventListener("DOMContentLoaded", function () {
        const inputNome = document.getElementById("filtro-nome");
        const selectStatus = document.getElementById("filtro-status");
        const linhas = document.querySelectorAll("tbody tr");

        function filtrar() {
            const nomeFiltro = inputNome.value.toLowerCase();
            const statusFiltro = selectStatus.value.toLowerCase();

            linhas.forEach(linha => {
                const nome = linha.children[0].innerText.toLowerCase();
                const status = linha.children[3].innerText.trim().toLowerCase();

                const nomeCond = nome.includes(nomeFiltro);
                const statusCond = statusFiltro === "" || status === statusFiltro;

                linha.style.display = nomeCond && statusCond ? "" : "none";
            });
        }

        inputNome.addEventListener("keyup", filtrar);
        selectStatus.addEventListener("change", filtrar);
    });
</script>
{% include 'admin_footer.html' %}
{% endblock %}