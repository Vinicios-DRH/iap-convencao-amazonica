<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin — Painel</title>
    <!-- Favicon básico -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}">

    <!-- PNGs (Chrome/Edge/Safari) -->
    <link rel="icon" type="image/png" sizes="32x32"
        href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16"
        href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}">

    <!-- iOS -->
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}">

    <!-- PWA (opcional) -->
    <link rel="manifest" href="{{ url_for('static', filename='favicon/site.webmanifest') }}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --pink: #d946ef;
            --cyan: #22d3ee;
            --bg: #070711;
            --card: rgba(255, 255, 255, .06);
            --border: rgba(255, 255, 255, .14);
            --muted: rgba(255, 255, 255, .72);
        }

        body {
            background:
                radial-gradient(900px 500px at 20% 10%, rgba(34, 211, 238, .18), transparent 60%),
                radial-gradient(900px 500px at 80% 20%, rgba(217, 70, 239, .20), transparent 60%),
                linear-gradient(180deg, #05050d, var(--bg));
            color: #f4f4fb;
        }

        .navy {
            background: rgba(0, 0, 0, .35);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .cardx {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 18px;
        }

        .btn-neon {
            background: linear-gradient(90deg, var(--cyan), var(--pink));
            border: none;
            color: #06060c;
            font-weight: 1000;
        }

        .btn-neon:hover {
            opacity: .92;
        }

        .pill {
            border: 1px solid rgba(255, 255, 255, .16);
            background: rgba(0, 0, 0, .22);
            border-radius: 999px;
            padding: .35rem .7rem;
            font-weight: 900;
            letter-spacing: .02em;
            color: #fff;
            display: inline-flex;
            align-items: center;
            gap: .5rem;
        }

        .muted {
            color: var(--muted);
        }

        .hero {
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, .18);
            background:
                radial-gradient(600px 250px at 15% 20%, rgba(34, 211, 238, .25), transparent 60%),
                radial-gradient(600px 250px at 85% 30%, rgba(217, 70, 239, .25), transparent 60%),
                rgba(255, 255, 255, .05);
            overflow: hidden;
        }

        .hl {
            background: linear-gradient(90deg, var(--cyan), var(--pink));
            -webkit-background-clip: text;
            color: transparent;
            font-weight: 1000;
        }

        .kpi {
            font-size: 1.85rem;
            font-weight: 1000;
            letter-spacing: -.02em;
            margin: 0;
            line-height: 1.0;
        }

        .kpi-sub {
            margin: 0;
            color: var(--muted);
            font-size: .95rem;
        }

        .quick {
            display: flex;
            gap: .75rem;
            flex-wrap: wrap;
        }

        .quick a {
            text-decoration: none;
        }

        /* Tabela mais “limpa” */
        .table-dark {
            --bs-table-bg: transparent;
        }

        .table>:not(caption)>*>* {
            border-color: rgba(255, 255, 255, .10);
        }
    </style>
</head>

<body>
    {% include "components/admin_nav.html" %}

    <main class="py-5">
        <div class="container">

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} mb-2" role="alert">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <div class="hero p-4 p-lg-5 mb-4">
                <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                    <div>
                        <div class="pill mb-2">ADMIN • CONTROLE</div>
                        <h1 class="display-6 fw-bold mb-2">Painel <span class="hl">Administrativo</span></h1>
                        <p class="muted mb-0" style="max-width: 70ch;">
                            Acompanhe inscrições, revise comprovantes e controle permissões. Tudo em um só lugar.
                        </p>
                    </div>

                    <div class="quick">
                        <a class="btn btn-neon" href="{{ url_for('admin_inscricoes') }}">Ver inscrições</a>

                        {% if current_user.is_super %}
                        <a class="btn btn-outline-light" href="{{ url_for('super_permissoes') }}">Permissões</a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- KPIs -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="cardx p-3">
                        <p class="kpi">{{ kpi_total }}</p>
                        <p class="kpi-sub">Total de inscrições</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="cardx p-3">
                        <p class="kpi">{{ kpi_aguardando }}</p>
                        <p class="kpi-sub">Aguardando confirmação</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="cardx p-3">
                        <p class="kpi">{{ kpi_confirmadas }}</p>
                        <p class="kpi-sub">Confirmadas</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="cardx p-3">
                        <p class="kpi">{{ kpi_negadas }}</p>
                        <p class="kpi-sub">Negadas</p>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-lg-7">
                    <div class="cardx p-4">
                        <h2 class="h5 fw-bold mb-2">Ações rápidas</h2>
                        <p class="muted mb-3">Atalhos para as tarefas mais comuns.</p>

                        <div class="d-flex gap-2 flex-wrap">
                            <a class="btn btn-neon"
                                href="{{ url_for('admin_inscricoes', status='AGUARDANDO_CONFIRMACAO') }}">
                                Revisar pendentes
                            </a>
                            <a class="btn btn-outline-light"
                                href="{{ url_for('admin_inscricoes', status='CONFIRMADA') }}">
                                Ver confirmadas
                            </a>
                            <a class="btn btn-outline-light" href="{{ url_for('admin_inscricoes', status='NEGADA') }}">
                                Ver negadas
                                <a class="btn btn-neon" href="{{ url_for('admin_relatorio_inscritos_xlsx') }}">
                                    Baixar relatório Excel
                                </a>
                                <a class="btn btn-outline-light"
                                    href="{{ url_for('admin_relatorio_inscritos_xlsx', status='AGUARDANDO_CONFIRMACAO') }}">
                                    Excel — Pendentes
                                </a>

                                <a class="btn btn-outline-light"
                                    href="{{ url_for('admin_relatorio_inscritos_xlsx', payment_type='pix') }}">
                                    Excel — Apenas Pix
                                </a>
                        </div>

                        <div class="mt-3 muted">
                            <div><b>Pendentes com comprovante enviado:</b> {{ kpi_pendentes_comprovante }}</div>
                        </div>

                        <hr style="border-color:rgba(255,255,255,.12)">

                        <div class="muted">
                            <div><b>Dica:</b> use a busca por nome/CPF/telefone/IAP para encontrar inscrições mais
                                rápido.</div>
                            <div class="mt-2"><b>Pix:</b> pagamentos devem terminar em <b>0,09</b>.</div>
                        </div>
                    </div>

                    <div class="cardx p-4 mt-4">
                        <h2 class="h5 fw-bold mb-2">Últimas inscrições</h2>
                        <p class="muted mb-3">Visão rápida das inscrições mais recentes.</p>

                        <div class="table-responsive">
                            <table class="table table-dark table-hover align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>IAP</th>
                                        <th>Status</th>
                                        <th>Tipo</th>
                                        <th>Comprovante</th>
                                        <th>Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for r in ultimas %}
                                    <tr>
                                        <td class="fw-semibold">{{ r.full_name }}</td>
                                        <td>{{ r.iap_local }}</td>

                                        <td>
                                            {% if r.status == 'CONFIRMADA' %}
                                            <span class="badge text-bg-success">CONFIRMADA</span>
                                            {% elif r.status == 'NEGADA' %}
                                            <span class="badge text-bg-danger">NEGADA</span>
                                            {% else %}
                                            <span class="badge text-bg-warning">AGUARDANDO</span>
                                            {% endif %}
                                        </td>

                                        <td>{{ 'Pix' if r.payment_type=='pix' else 'Crédito' }}</td>

                                        <td>
                                            {% if r.payment_type == 'pix' %}
                                            {% if r.proof_file_path %}
                                            <span class="badge text-bg-success">Comprovante: OK</span>
                                            {% else %}
                                            <span class="badge text-bg-secondary">Comprovante: —</span>
                                            {% endif %}
                                            {% else %}
                                            <span class="badge text-bg-dark">N/A</span>
                                            {% endif %}
                                        </td>

                                        <td class="muted">{{ r.created_at|fmt_manaus }}</td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="6" class="muted">Nenhuma inscrição encontrada.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3 d-flex gap-2 flex-wrap">
                            <a class="btn btn-neon" href="{{ url_for('admin_inscricoes') }}">Ver todas</a>
                            <a class="btn btn-outline-light"
                                href="{{ url_for('admin_inscricoes', status='AGUARDANDO_CONFIRMACAO') }}">
                                Ir para pendentes
                            </a>
                        </div>
                    </div>
                </div>

                <div class="col-lg-5">
                    <div class="cardx p-4">
                        <h2 class="h5 fw-bold mb-2">Permissões</h2>
                        <p class="muted mb-3">
                            Somente <b>SUPER</b> consegue gerenciar funções/roles.
                        </p>

                        {% if current_user.is_super %}
                        <a class="btn btn-neon w-100" href="{{ url_for('super_permissoes') }}">Gerenciar permissões</a>
                        {% else %}
                        <button class="btn btn-outline-light w-100" disabled>Somente SUPER</button>
                        {% endif %}

                        <hr style="border-color:rgba(255,255,255,.12)">

                        <div class="muted">
                            <div><b>Roles disponíveis:</b></div>
                            <ul class="mb-0">
                                <li>SUPER</li>
                                <li>ADMIN</li>
                                <li>REVISOR_PAGAMENTOS</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    {% include "components/footer.html" %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>